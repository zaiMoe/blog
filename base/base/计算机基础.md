# 计算机基础

## 进程、线程、协程、线程

操作系统的主要目标是执行用户程序，但也需要顾及内核之外的各种系统任务。

系统由一组进程组成： 操作系统进程执行系统代码，用户进程执行用户代码。

### 进程

可看做是正在执行的程序，进程需要一定的资源（如 CPU、时间、内存、文件和 I/O 设备）来完成其任务。 这些资源在创建进程或者执行进程时被分配。

- 进程的组成有：PCB、程序段、数据段
  - PCB（进程控制块，process control block）： 保存进程运行期间相关的数据，是进程存在的唯一标志。
  - 程序段： 能被进程调度程序调度到 CPU 运行的程序的代码段。
  - 数据段： 存储程序运行期间的相关数据，可以是原始数据也可以是相关结果。

创建进程： 需要为进程划分出一块完整的内存空间，有大量的初始化操作，比如要把内存分段（堆栈、正文区等）。

进程在执行时会改变状态，进程的状态有 5 种：
![](./imgs/%E8%BF%9B%E7%A8%8B.png)

- 创建：进程正在被创建。
- 运行：指令正在被执行。
- 等待：阻塞，进程等待某个事件的发生（如 I/O 完成或收到信号）。
- 就绪：进程等待分配处理器。
- 终止：进程完成执行。

> Tips ：将 CPU 切换到另一个进程需要保存当前进程的状态并恢复另一个进程的状态，这一任务称为上下文切换（context switch） 。

### 线程

- 线程是 CPU 使用的基本单元，由线程 ID、程序计数器、寄存器集合和栈组成。
- 进程由一个或多个线程组成： Linux 中创建一个进程自然会创建一个线程，也就是主线程。
- 调度切换： 线程上下文切换比进程上下文切换快。
- 进程创建很耗时间和资源：
  - 创建进程： 需要为进程划分出一块完整的内存空间，有大量的初始化操作，比如要把内存分段（堆栈、正文区等）。
  - 创建线程： 只需要确定 PC 指针和寄存器的值，并且给线程分配一个栈用于执行程序，同一个进程的多个线程间可以复用堆栈。

