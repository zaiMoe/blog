# 进制转换与位移操作

## js中的进制转换

### 十进制转其他进制 -- toString

```js
var ba = 8;
ba.toString(2) // '1000'
ba.toString(8) // '10'
ba.toString(16) // '8'
```

### 其他进制转十进制

parseInt: 解析传入的参数，转化成10进制

```js
parseInt('1000', 2) // 8
parseInt('10', 16) // 16
parseInt('10', 8) // 10
```

### 任意进制转换

先转十进制`parseInt`，在转其他进制`toString`

例子1：
-5的二进制转十进制

- 计算机以补码形式表示负数：1011
- 取补码: 1100 + 1 = 1101 = -5

### 补0操作

```js
'1'.padStart(32, 0) // "00000000000000000000000000000001"
'1'.padEnd(32, 0) // "10000000000000000000000000000000"
```

注：ie不支持

## 有符号数有3种表示法

### 原码

二进制原码

```text
2: 010
4: 0100
-4: 1100 
```

### 反码

> 反码通常是用来由原码求补码或者由补码求原码的过渡码。

正数的反码与其原码相同。
负数的反码，除符号位外，其他位取反。

```text
4: 0100
-4: 1011
```

### 补码

> 在计算机系统中，数值一律用补码来表示和存储。原因在于，使用补码，可以将符号位和数值域统一处理；同时，加法和减法也可以统一处理

1. 正整数的补码与其原码相同。（两者相加都会溢出进位）
2. 负整数的补码，取反码+1。(模是2)
3. 补码的补码就是则的原码

```text
4: 0100
-4: 1100
```

#### 说明

模：实质上是计量器产生“溢出”的量，如：时钟的计量范围是0~11，模=12。表示n位的计算机计量范围是0~2^n -1，模=2^n。

假设当前时针指向8点，而准确时间是6点，调整时间可有以下两种拨法：一种是倒拨2小时，即8-2=6；另一种是顺拨10小时，8+10=12+6=6，即8-2=8+10=8+12-2(mod 12)．在12为模的系统里，加10和减2效果是一样的（10 + 2会产出溢出，所以二级制的正数的补码等于自身），因此凡是减2运算，都可以用加10来代替。

对应到计算机上则是：`2 - 4`可以表示为`2补码 + -4的补码`等于`010 + 1100 = 1110`取原码`1010 = -2`，符号位与数值位可以一起运算。

```text
-2 - 4
原码：         1010 + 1100
补码：         1110 + 1100
补码结果：   11010
高位溢出：   1010
原码：         1110
结果：         -6
```

## 位运算符

十进制的：

- 与（&）：先转2进制补码，在按位比较
- 或（|）：同上
- 非（~）：将操作数取负，然后-1
- 异或（^）同上上
- 带符号左移（<<）
- 带符号右移（>>）
- 无符号右移（>>>）

### 左移 （<<）

将二进制串向左移动指定位数，左边超出的位数将会被清除，右边（低位）将会补零。

```js
var a = 1 // 0000 0001 

a << 3 // 0000 1000 - 8
```

移动任意数字 x 至左边 y 位，得出 x * 2 ** y。
比如 1 * 2³ = 8

###### 说明

按位运算符将其操作数转换为**带符号的32位数**，数字位只有31位（左边第一位0是正数，1是负数），当左移后的二进制位超过32位的时候，只会保留后面的32位，此时的左边的第一位可能是`0`or`1`。
数值范围从 -2147483647 到 2147483647

```js
(1 << 30).toString(2) // 1000000000000000000000000000000
(1 << 31).toString(2) // -10000000000000000000000000000000 1是第32位，所以为负数
(1 << 32).toString(2) // 1 左移32位等于原来的值
```

### 右移（>>）

向右进行移位操作，对无符号数，高位补 0，对于有符号数，高位补符号位。

```js
var a = 4 // 0100
a >> 2 // 0001 = 1

var b = -4 // 1100(补码)
b >> 2 // 1111 -> 1001 = -1

b >> 4 // -1 超出了，所有位置都是1
```

### 无符号右移

```js
var a = 4 // 0100
a >>> 2 // 0001 = 1 正数无变化

var b = -4 // 1100(补码)
b >> 2 // 0011 -> 3 （32位的情况下，数值会很大）

b >> 3 // 0001 -> 1
```

## 常用技巧

### 1. 乘除

左移表示除2，右移表示乘2

```js
2 >> 1 // 1
2 << 1 //  4
16 >> 2 // 4
1 << 2 // 4
```

### 2. 消除末尾的1来统计1的个数

`xor &= xor - 1; // 消除一位1`

## 参考

<https://www.kancloud.cn/chandler/javascript/785489>
